<div class="booking-details-container">
  <div class="page-header">
    <h1>Event Management Search</h1>
    <p class="subtitle">Search for events by title or booking ID</p>
  </div>
 
  <!-- Search Form -->
  <div class="search-section">
    <form [formGroup]="itemForm" (ngSubmit)="searchEvent()" class="search-form">
      <div class="form-group">
        <label for="searchTerm">Search Event</label>
        <div class="input-group">
          <input 
            type="text" 
            id="searchTerm"
            formControlName="searchTerm" 
            class="form-control"
            placeholder="Enter event ID or title"
            [class.is-invalid]="itemForm.get('searchTerm')?.invalid && itemForm.get('searchTerm')?.touched"
          />
          <button type="submit" class="btn btn-primary" [disabled]="!itemForm.valid">
            <span class="search-icon">üîç</span>
            Search
          </button>
        </div>
        <div class="error-message" *ngIf="itemForm.get('searchTerm')?.invalid && itemForm.get('searchTerm')?.touched">
          Search term is required
        </div>
      </div>
    </form>
  </div>
 
  <!-- Status Message -->
  <div *ngIf="message" class="alert" [ngClass]="message.type === 'success' ? 'alert-success' : 'alert-error'">
    <span class="alert-icon">{{ message.type === 'success' ? '‚úì' : '‚úï' }}</span>
    {{ message.text }}
  </div>
 
  <!-- No Results Message -->
  <div *ngIf="searchPerformed && eventObj.length === 0 && !message" class="no-results">
    <div class="no-results-icon">üì≠</div>
    <h3>No Events Found</h3>
    <p>No events found matching your search criteria</p>
  </div>
 
  <!-- Results Table -->
  <div *ngIf="searchPerformed && eventObj.length > 0" class="results-section">
    <div class="table-card">
      <h3 class="table-title">Search Results</h3>
      <div class="table-responsive">
        <table class="events-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Title</th>
              <th>Description</th>
              <th>Date</th>
              <th>Location</th>
              <th>Status</th>
              <th>Allocations</th>
              <th>Total Price</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let event of eventObj">
              <td>{{ event.eventID }}</td>
              <td>{{ event.title }}</td>
              <td>{{ event.description | slice:0:50 }}{{ event.description?.length > 50 ? '...' : '' }}</td>
              <td>{{ event.dateTime | date:'medium' }}</td>
              <td>{{ event.location }}</td>
              <td>
                <span class="badge" [ngClass]="getStatusClass(event.status)">
                  {{ event.status }}
                </span>
              </td>
              <td>
                <span 
                  class="allocation-info"
                  (mouseenter)="showTooltip($event, event.allocations)"
                  (mouseleave)="hideTooltip()"
                  *ngIf="event.allocations && event.allocations.length > 0"
                >
                  {{ event.allocations.length }} Allocation(s)
                  <span class="info-icon">‚ìò</span>
                </span>
                <span *ngIf="!event.allocations || event.allocations.length === 0">
                  No allocations
                </span>
              </td>
              <td>
                <span class="price-badge">
                  ‚Çπ{{ calculateTotalPrice(event.allocations) | number:'1.2-2' }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
 
  <!-- Custom Tooltip with Price -->
  <div 
    *ngIf="tooltipVisible" 
    class="custom-tooltip"
    [style.left.px]="tooltipX"
    [style.top.px]="tooltipY"
  >
    <div *ngFor="let allocation of tooltipContent; let last = last" class="allocation-item">
      <p><strong>Resource:</strong> {{ allocation.resource.name }}</p>
      <p><strong>Type:</strong> {{ allocation.resource.type }}</p>
      <p><strong>Quantity:</strong> {{ allocation.quantity }}</p>
      <p><strong>Unit Price:</strong> ‚Çπ{{ allocation.resource.price | number:'1.2-2' }}</p>
      <p><strong>Subtotal:</strong> ‚Çπ{{ calculateAllocationPrice(allocation) | number:'1.2-2' }}</p>
      <hr *ngIf="!last" class="allocation-divider">
    </div>
    <div class="tooltip-total" *ngIf="tooltipContent.length > 0">
      <strong>Total: ‚Çπ{{ calculateTotalPrice(tooltipContent) | number:'1.2-2' }}</strong>
    </div>
  </div>
</div>