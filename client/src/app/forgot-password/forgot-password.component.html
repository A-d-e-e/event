<div class="forgot-password-page">
  <div class="forgot-password-container">
    
    <!-- Header -->
    <div class="page-header">
      <button class="btn-back" routerLink="/login">
        <i class="fas fa-arrow-left"></i>
        Back to Login
      </button>
      <h1 class="page-title">Reset Your Password</h1>
      <p class="page-subtitle">Follow the steps below to recover your account</p>
    </div>
 
    <!-- Progress Indicator -->
    <div class="progress-steps">
      <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
        <div class="step-circle">
          <i class="fas fa-envelope" *ngIf="currentStep <= 1"></i>
          <i class="fas fa-check" *ngIf="currentStep > 1"></i>
        </div>
        <span class="step-label">Email</span>
      </div>
      <div class="step-line" [class.completed]="currentStep > 1"></div>
      <div class="step" [class.active]="currentStep === 2" [class.completed]="currentStep > 2">
        <div class="step-circle">
          <i class="fas fa-key" *ngIf="currentStep <= 2"></i>
          <i class="fas fa-check" *ngIf="currentStep > 2"></i>
        </div>
        <span class="step-label">Verify OTP</span>
      </div>
      <div class="step-line" [class.completed]="currentStep > 2"></div>
      <div class="step" [class.active]="currentStep === 3" [class.completed]="currentStep > 3">
        <div class="step-circle">
          <i class="fas fa-lock"></i>
        </div>
        <span class="step-label">New Password</span>
      </div>
    </div>
 
    <!-- Step 1: Enter Email -->
    <div class="step-content" *ngIf="currentStep === 1">
      <div class="step-icon">
        <i class="fas fa-envelope"></i>
      </div>
      <h2 class="step-title">Enter Your Email</h2>
      <p class="step-description">We'll send you a verification code to reset your password</p>
      
      <form [formGroup]="emailForm" (ngSubmit)="sendOTP()">
        <div class="form-group">
          <label for="email">Email Address</label>
          <div class="input-wrapper">
            <i class="fas fa-envelope input-icon"></i>
            <input 
              type="email" 
              id="email" 
              formControlName="email" 
              placeholder="Enter your registered email"
              [class.error-input]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
          </div>
          <div class="error-text" *ngIf="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
            <span *ngIf="emailForm.get('email')?.errors?.['required']">Email is required</span>
            <span *ngIf="emailForm.get('email')?.errors?.['email']">Please enter a valid email</span>
          </div>
        </div>
 
        <button type="submit" class="btn-primary" [disabled]="emailForm.invalid || isLoading">
          <span *ngIf="!isLoading">Send Verification Code</span>
          <span *ngIf="isLoading">
            <i class="fas fa-spinner fa-spin"></i> Sending...
          </span>
        </button>
      </form>
    </div>
 
    <!-- Step 2: Verify OTP -->
    <div class="step-content" *ngIf="currentStep === 2">
      <div class="step-icon">
        <i class="fas fa-key"></i>
      </div>
      <h2 class="step-title">Verify OTP</h2>
      <p class="step-description">
        We've sent a 6-digit code to <strong>{{ emailForm.get('email')?.value }}</strong>
      </p>
      
      <form [formGroup]="otpForm" (ngSubmit)="verifyOTP()">
        <div class="form-group">
          <label for="otp">Enter 6-Digit Code</label>
          <div class="otp-input-wrapper">
            <input 
              type="text" 
              id="otp" 
              formControlName="otp" 
              placeholder=""
              maxlength="8"
              class="otp-input"
              [class.error-input]="otpForm.get('otp')?.invalid && otpForm.get('otp')?.touched">
          </div>
          <div class="error-text" *ngIf="otpForm.get('otp')?.invalid && otpForm.get('otp')?.touched">
            <span *ngIf="otpForm.get('otp')?.errors?.['required']">OTP is required</span>
            <span *ngIf="otpForm.get('otp')?.errors?.['pattern']">Please enter a 6-digit code</span>
          </div>
        </div>
 
        <div class="resend-section">
          <p>Didn't receive the code?</p>
          <button type="button" class="btn-link" (click)="resendOTP()" [disabled]="resendTimer > 0">
            <span *ngIf="resendTimer === 0">Resend Code</span>
            <span *ngIf="resendTimer > 0">Resend in {{ resendTimer }}s</span>
          </button>
        </div>
 
        <button type="submit" class="btn-primary" [disabled]="otpForm.invalid || isLoading">
          <span *ngIf="!isLoading">Verify Code</span>
          <span *ngIf="isLoading">
            <i class="fas fa-spinner fa-spin"></i> Verifying...
          </span>
        </button>
      </form>
    </div>
 
    <!-- Step 3: Set New Password -->
    <div class="step-content" *ngIf="currentStep === 3">
      <div class="step-icon">
        <i class="fas fa-lock"></i>
      </div>
      <h2 class="step-title">Create New Password</h2>
      <p class="step-description">Your new password must be different from previously used passwords</p>
      
      <form [formGroup]="passwordForm" (ngSubmit)="resetPassword()">
        <div class="form-group">
          <label for="password">New Password</label>
          <div class="input-wrapper">
            <i class="fas fa-lock input-icon"></i>
            <input 
              [type]="showPassword ? 'text' : 'password'" 
              id="password" 
              formControlName="password" 
              placeholder="Enter new password"
              [class.error-input]="passwordForm.get('password')?.invalid && passwordForm.get('password')?.touched">
            <button type="button" class="toggle-password" (click)="showPassword = !showPassword">
              <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
            </button>
          </div>
          <div class="password-strength" *ngIf="passwordForm.get('password')?.value">
            <div class="strength-bar" [class]="getPasswordStrength()"></div>
            <span class="strength-text">{{ getPasswordStrengthText() }}</span>
          </div>
          <div class="error-text" *ngIf="passwordForm.get('password')?.invalid && passwordForm.get('password')?.touched">
            <span *ngIf="passwordForm.get('password')?.errors?.['required']">Password is required</span>
            <span *ngIf="passwordForm.get('password')?.errors?.['minlength']">Password must be at least 6 characters</span>
          </div>
        </div>
 
        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <div class="input-wrapper">
            <i class="fas fa-lock input-icon"></i>
            <input 
              [type]="showConfirmPassword ? 'text' : 'password'" 
              id="confirmPassword" 
              formControlName="confirmPassword" 
              placeholder="Confirm your password"
              [class.error-input]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
            <button type="button" class="toggle-password" (click)="showConfirmPassword = !showConfirmPassword">
              <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
            </button>
          </div>
          <div class="error-text" *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
            <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">Please confirm your password</span>
          </div>
          <div class="error-text" *ngIf="passwordForm.errors?.['passwordMismatch'] && passwordForm.get('confirmPassword')?.touched">
            Passwords do not match
          </div>
        </div>
 
        <div class="password-requirements">
          <p class="requirements-title">Password requirements:</p>
          <ul class="requirements-list">
            <li [class.met]="passwordForm.get('password')?.value?.length >= 6">
              <i class="fas fa-check-circle"></i> At least 6 characters
            </li>
            <li [class.met]="hasUpperCase()">
              <i class="fas fa-check-circle"></i> One uppercase letter
            </li>
            <li [class.met]="hasLowerCase()">
              <i class="fas fa-check-circle"></i> One lowercase letter
            </li>
            <li [class.met]="hasNumber()">
              <i class="fas fa-check-circle"></i> One number
            </li>
          </ul>
        </div>
 
        <button type="submit" class="btn-primary" [disabled]="passwordForm.invalid || isLoading">
          <span *ngIf="!isLoading">Reset Password</span>
          <span *ngIf="isLoading">
            <i class="fas fa-spinner fa-spin"></i> Updating...
          </span>
        </button>
      </form>
    </div>
 
    <!-- Success State -->
    <div class="step-content success-state" *ngIf="currentStep === 4">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2 class="success-title">Password Reset Successfully!</h2>
      <p class="success-description">
        Your password has been updated. You can now login with your new password.
      </p>
      <button class="btn-primary" routerLink="/login">
        Go to Login
        <i class="fas fa-arrow-right"></i>
      </button>
    </div>
 
  </div>
</div>
 