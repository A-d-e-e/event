<div class="payment-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title">
      <span class="header-icon">üí≥</span>
      Event Payment Portal
    </h1>
    <p class="page-subtitle">Search for your event and complete payment securely</p>
  </div>

  <!-- Status Message -->
  <div *ngIf="message" class="alert" [ngClass]="message.type === 'success' ? 'alert-success' : 'alert-error'">
    <span class="alert-icon">{{ message.type === 'success' ? '‚úì' : '‚úï' }}</span>
    <span class="alert-text">{{ message.text }}</span>
  </div>

  <!-- Search Section -->
  <div class="search-section">
    <div class="section-header">
      <h2 class="section-title">
        <span class="section-icon">üîç</span>
        Find Your Event
      </h2>
    </div>

    <form [formGroup]="searchForm" (ngSubmit)="searchEvent()">
      <div class="search-bar">
        <input 
          type="text" 
          formControlName="searchTerm"
          placeholder="Enter Event ID or Title..."
          class="search-input">
        <button type="submit" class="btn btn-search" [disabled]="searchForm.invalid">
          <span class="btn-icon">üîç</span>
          <span class="btn-text">Search</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Event Details & Payment Section -->
  <div *ngIf="selectedEvent" class="event-payment-section">
    <!-- Event Details Card -->
    <div class="event-card">
      <div class="card-header">
        <h3>üìÖ Event Details</h3>
      </div>
      <div class="card-body">
        <div class="detail-row">
          <span class="detail-label">Event Name:</span>
          <span class="detail-value">{{ selectedEvent.title }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Location:</span>
          <span class="detail-value">üìç {{ selectedEvent.location }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Date & Time:</span>
          <span class="detail-value">üïí {{ selectedEvent.dateTime | date: 'medium' }}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Status:</span>
          <span class="status-badge" [ngClass]="'status-' + selectedEvent.status">
            {{ selectedEvent.status | titlecase }}
          </span>
        </div>
      </div>
    </div>

    <!-- Resources Allocated -->
    <div class="resources-card">
      <div class="card-header">
        <h3>üì¶ Resources Allocated</h3>
      </div>
      <div class="card-body">
        <div *ngIf="allocations.length > 0" class="resources-table">
          <table>
            <thead>
              <tr>
                <th>Resource</th>
                <th>Type</th>
                <th>Unit Price</th>
                <th>Quantity</th>
                <th>Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let allocation of allocations">
                <td>{{ allocation.resource.name }}</td>
                <td>{{ allocation.resource.type }}</td>
                <td>‚Çπ{{ allocation.resource.price | number:'1.2-2' }}</td>
                <td>{{ allocation.quantity }}</td>
                <td class="subtotal">‚Çπ{{ calculateSubtotal(allocation) | number:'1.2-2' }}</td>
              </tr>
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="4"><strong>Total Amount</strong></td>
                <td class="total-amount"><strong>‚Çπ{{ totalAmount | number:'1.2-2' }}</strong></td>
              </tr>
            </tfoot>
          </table>
        </div>
        <div *ngIf="allocations.length === 0" class="no-resources">
          <p>No resources allocated for this event</p>
        </div>
      </div>
    </div>

    <!-- Payment Button -->
    <div class="payment-action">
      <button class="btn btn-pay" (click)="openPaymentModal()" *ngIf="totalAmount > 0">
        <span class="btn-icon">üí∞</span>
        <span class="btn-text">Proceed to Payment - ‚Çπ{{ totalAmount | number:'1.2-2' }}</span>
      </button>
    </div>
  </div>

  <!-- Payment Modal -->
  <div class="modal-overlay" *ngIf="showPaymentModal" (click)="closePaymentModal()">
    <div class="modal-content payment-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üí≥ Enter Payment Details</h2>
        <button class="modal-close" (click)="closePaymentModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <form [formGroup]="paymentForm">
          <div class="form-group">
            <label>Customer Name <span class="required">*</span></label>
            <input type="text" formControlName="customerName" placeholder="Enter your full name" class="form-input">
            <div class="error-text" *ngIf="paymentForm.get('customerName')?.invalid && paymentForm.get('customerName')?.touched">
              Name is required
            </div>
          </div>

          <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input type="email" formControlName="customerEmail" placeholder="your.email@example.com" class="form-input">
            <div class="error-text" *ngIf="paymentForm.get('customerEmail')?.invalid && paymentForm.get('customerEmail')?.touched">
              Valid email is required
            </div>
          </div>

          <div class="form-group">
            <label>Phone Number <span class="required">*</span></label>
            <input type="tel" formControlName="customerPhone" placeholder="10-digit phone number" class="form-input">
            <div class="error-text" *ngIf="paymentForm.get('customerPhone')?.invalid && paymentForm.get('customerPhone')?.touched">
              Valid 10-digit phone number required
            </div>
          </div>

          <div class="payment-summary">
            <div class="summary-row">
              <span>Total Amount:</span>
              <span class="amount">‚Çπ{{ totalAmount | number:'1.2-2' }}</span>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closePaymentModal()">Cancel</button>
        <button class="btn btn-primary" (click)="proceedToUpi()" [disabled]="isProcessing">
          <span *ngIf="!isProcessing">Continue to UPI Payment</span>
          <span *ngIf="isProcessing">Processing...</span>
        </button>
      </div>
    </div>
  </div>

  <!-- UPI Payment Modal -->
  <div class="modal-overlay" *ngIf="showUpiModal" (click)="closeUpiModal()">
    <div class="modal-content upi-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>üì± UPI Payment</h2>
        <button class="modal-close" (click)="closeUpiModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="upi-info">
          <div class="upi-icon">üì≤</div>
          <h3>Pay using UPI</h3>
          <p class="upi-description">Enter your UPI ID to complete the payment</p>
          
          <div class="amount-display">
            <div class="amount-label">Amount to Pay</div>
            <div class="amount-value">‚Çπ{{ totalAmount | number:'1.2-2' }}</div>
          </div>

          <form [formGroup]="paymentForm">
            <div class="form-group">
              <label>UPI ID <span class="required">*</span></label>
              <input 
                type="text" 
                formControlName="upiId" 
                placeholder="yourname@upi" 
                class="form-input upi-input">
              <div class="error-text" *ngIf="paymentForm.get('upiId')?.invalid && paymentForm.get('upiId')?.touched">
                Valid UPI ID required (e.g., user@paytm)
              </div>
            </div>
          </form>

          <div class="upi-examples">
            <p class="examples-label">Supported UPI Apps:</p>
            <div class="upi-apps">
              <span class="upi-app">Google Pay</span>
              <span class="upi-app">PhonePe</span>
              <span class="upi-app">Paytm</span>
              <span class="upi-app">BHIM</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeUpiModal()">Cancel</button>
        <button class="btn btn-success" (click)="processUpiPayment()" [disabled]="isProcessing">
          <span *ngIf="!isProcessing">üí∞ Pay ‚Çπ{{ totalAmount | number:'1.2-2' }}</span>
          <span *ngIf="isProcessing">Processing Payment...</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Bill Summary Modal -->
  <div class="modal-overlay" *ngIf="showBillSummary">
    <div class="modal-content bill-modal" (click)="$event.stopPropagation()">
      <div class="modal-header success-header">
        <div class="success-animation">
          <div class="checkmark">‚úì</div>
        </div>
        <h2>Payment Successful!</h2>
        <button class="modal-close" (click)="closeBillSummary()">‚úï</button>
      </div>
      <div class="modal-body bill-body">
        <!-- Transaction Details -->
        <div class="transaction-details">
          <h3>üìÑ Transaction Details</h3>
          <div class="detail-item">
            <span class="label">Transaction ID:</span>
            <span class="value transaction-id">{{ transactionDetails?.transactionId }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Date & Time:</span>
            <span class="value">{{ transactionDetails?.paymentDate | date: 'medium' }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Payment Method:</span>
            <span class="value">UPI ({{ transactionDetails?.upiId }})</span>
          </div>
          <div class="detail-item">
            <span class="label">Status:</span>
            <span class="value status-success">{{ transactionDetails?.paymentStatus }}</span>
          </div>
        </div>

        <!-- Customer Details -->
        <div class="customer-details">
          <h3>üë§ Customer Information</h3>
          <div class="detail-item">
            <span class="label">Name:</span>
            <span class="value">{{ transactionDetails?.customerName }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Email:</span>
            <span class="value">{{ transactionDetails?.customerEmail }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Phone:</span>
            <span class="value">{{ transactionDetails?.customerPhone }}</span>
          </div>
        </div>

        <!-- Event Details -->
        <div class="bill-event-details">
          <h3>üìÖ Event Information</h3>
          <div class="detail-item">
            <span class="label">Event Name:</span>
            <span class="value">{{ selectedEvent?.title }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Location:</span>
            <span class="value">{{ selectedEvent?.location }}</span>
          </div>
          <div class="detail-item">
            <span class="label">Date:</span>
            <span class="value">{{ selectedEvent?.dateTime | date: 'medium' }}</span>
          </div>
        </div>

        <!-- Items Summary -->
        <div class="items-summary">
          <h3>üì¶ Items</h3>
          <table class="bill-table">
            <thead>
              <tr>
                <th>Item</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let allocation of allocations">
                <td>{{ allocation.resource.name }}</td>
                <td>{{ allocation.quantity }}</td>
                <td>‚Çπ{{ allocation.resource.price | number:'1.2-2' }}</td>
                <td>‚Çπ{{ calculateSubtotal(allocation) | number:'1.2-2' }}</td>
              </tr>
            </tbody>
            <tfoot>
              <tr class="total-row">
                <td colspan="3"><strong>Total Paid</strong></td>
                <td><strong>‚Çπ{{ totalAmount | number:'1.2-2' }}</strong></td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="bill-footer-note">
          <p>Thank you for your payment! A confirmation email has been sent to {{ transactionDetails?.customerEmail }}</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="downloadBill()">
          <span class="btn-icon">üì•</span>
          Download Receipt
        </button>
        <button class="btn btn-primary" (click)="shareBill()">
          <span class="btn-icon">üì§</span>
          Share Receipt
        </button>
        <button class="btn btn-success" (click)="closeBillSummary()">
          Done
        </button>
      </div>
    </div>
  </div>
</div>