<section class="main-section">
  <div class="container px-4 py-5 px-md-5 my-5">
    <h1 class="display-4 fw-bold text-center mb-5 main-title">
      Manage Events
    </h1>

    <!-- Messages Section -->
    <div *ngIf="message" class="alert mt-3 mb-4 message-alert"
      [ngClass]="{'alert-success': message.type === 'success', 'alert-danger': message.type === 'error'}"
      role="alert">
      <i class="bi" [ngClass]="message.type === 'success' ? 'bi-check-circle-fill' : 'bi-exclamation-triangle-fill'"></i>
      {{ message.text }}
    </div>

    <!-- <div *ngIf="showError" class="alert alert-danger mt-3 mb-4 message-alert" role="alert">
      <i class="bi bi-exclamation-triangle-fill"></i>
      {{ errorMessage }}
    </div> -->

    <div *ngIf="showMessage" class="alert alert-success mt-3 mb-4 message-alert" role="alert">
      <i class="bi bi-check-circle-fill"></i>
      {{ responseMessage }}
    </div>

    <!-- Search Form -->
    <div class="card bg-glass mx-auto mb-4 search-card">
      <div class="card-body p-4">
        <form [formGroup]="itemForm" (ngSubmit)="searchEvent()">
          <div class="input-group input-group-lg">
            <span class="input-group-text bg-white border-end-0">
              <i class="bi bi-search"></i>
            </span>
            <input type="text" formControlName="searchTerm" class="form-control border-start-0" 
              placeholder="Search by ID or Title...">
            <button type="submit" class="btn btn-primary px-4 search-btn">
              <i class="bi bi-search me-2"></i>Search
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Events Table Card -->
    <div class="card bg-glass mx-auto events-card">
      <div class="card-header bg-transparent border-bottom-0 pt-4 pb-3">
        <div class="row align-items-center">
          <div class="col-md-4">
            <h4 class="card-title mb-0 fw-bold">
              <i class="bi bi-calendar-event me-2"></i>Events List
            </h4>
          </div>
          <div class="col-md-4">
            <div class="filter-group">
              <label for="filter" class="form-label fw-semibold mb-1">
                <i class="bi bi-funnel me-1"></i>Filter:
              </label>
              <select id="filter" (change)="onFilterChange($event)" class="form-select">
                <option value="all">All Events</option>
                <option value="past">Past Events</option>
                <option value="today">Today's Events</option>
                <option value="future">Future Events</option>
              </select>
            </div>
          </div>
          <div class="col-md-4">
            <div class="sort-group">
              <label for="sort" class="form-label fw-semibold mb-1">
                <i class="bi bi-sort-down me-1"></i>Sort By:
              </label>
              <select id="sort" (change)="onSortChange($event)" class="form-select">
                <option value="">Default</option>
                <option value="id">ID</option>
                <option value="title">Title</option>
                <option value="date">Date</option>
                <option value="location">Location</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <div class="card-body p-4">
        <div class="table-responsive">
          <table class="table table-hover events-table">
            <thead>
              <tr>
                <th scope="col"><i class="bi bi-hash me-1"></i>ID</th>
                <th scope="col"><i class="bi bi-bookmark me-1"></i>Title</th>
                <th scope="col"><i class="bi bi-text-paragraph me-1"></i>Description</th>
                <th scope="col"><i class="bi bi-calendar3 me-1"></i>Date & Time</th>
                <th scope="col"><i class="bi bi-geo-alt me-1"></i>Location</th>
                <th scope="col"><i class="bi bi-info-circle me-1"></i>Status</th>
                <th scope="col"><i class="bi bi-gear me-1"></i>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let event of paginatedEvents">
                <td class="fw-semibold">#{{ event.eventID }}</td>
                <td class="event-title-cell">{{ event.title }}</td>
                <td class="event-desc-cell">{{ event.description }}</td>
                <td>
                  <i class="bi bi-clock me-1"></i>
                  {{ event.dateTime | date:'medium' }}
                </td>
                <td>
                  <i class="bi bi-pin-map me-1"></i>
                  {{ event.location }}
                </td>
                <td>
                  <span class="badge status-badge" 
                    [ngClass]="{
                      'bg-primary': event.status === 'Scheduled',
                      'bg-success': event.status === 'Completed',
                      'bg-danger': event.status === 'Cancelled',
                      'bg-warning': event.status === 'Ongoing'
                    }">
                    {{ event.status }}
                  </span>
                </td>
                <td>
                  <button class="btn btn-sm btn-primary update-btn" 
                    (click)="edit(event)" 
                    data-bs-toggle="modal"
                    data-bs-target="#updateModal">
                    <i class="bi bi-pencil-square me-1"></i>Update
                  </button>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Empty State -->
          <div *ngIf="paginatedEvents.length === 0" class="text-center py-5 empty-state">
            <i class="bi bi-calendar-x display-1 text-muted mb-3"></i>
            <h5 class="text-muted">No Events Found</h5>
            <p class="text-muted">{{ searchPerformed ? 'Try adjusting your search criteria' : 'No events available at the moment' }}</p>
          </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-controls d-flex justify-content-between align-items-center mt-4 pt-3 border-top" *ngIf="totalPages > 0">
          <button class="btn btn-outline-primary pagination-btn" 
            (click)="previousPage()" 
            [disabled]="currentPage === 1">
            <i class="bi bi-chevron-left me-1"></i>Previous
          </button>
          <span class="pagination-info fw-semibold">
            Page <span class="text-primary">{{ currentPage }}</span> of <span class="text-primary">{{ totalPages }}</span>
          </span>
          <button class="btn btn-outline-primary pagination-btn" 
            (click)="nextPage()" 
            [disabled]="currentPage === totalPages">
            Next<i class="bi bi-chevron-right ms-1"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Update Modal -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-glass modal-custom">
      <div class="modal-header border-bottom-0">
        <h5 class="modal-title fw-bold" id="updateModalLabel">
          <i class="bi bi-pencil-square me-2"></i>{{ isUpdate ? 'Update Event' : 'Create Event' }}
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <form [formGroup]="itemForm" (ngSubmit)="onSubmit()">
          
          <div class="mb-4">
            <label for="title" class="form-label fw-semibold">
              <i class="bi bi-bookmark me-1"></i>Title:
            </label>
            <input type="text" id="title" formControlName="title"
              class="form-control form-control-lg" 
              placeholder="Enter event title"/>
            <div *ngIf="itemForm.get('title')?.hasError('required') && itemForm.get('title')?.touched"
              class="text-danger mt-1 small">
              <i class="bi bi-exclamation-circle me-1"></i>Title is required.
            </div>
          </div>

          <div class="mb-4">
            <label for="description" class="form-label fw-semibold">
              <i class="bi bi-text-paragraph me-1"></i>Description:
            </label>
            <textarea id="description" formControlName="description"
              class="form-control form-control-lg" 
              rows="3"
              placeholder="Describe your event"></textarea>
            <div *ngIf="itemForm.get('description')?.hasError('required') && itemForm.get('description')?.touched"
              class="text-danger mt-1 small">
              <i class="bi bi-exclamation-circle me-1"></i>Description is required.
            </div>
          </div>

          <div class="mb-4">
            <label for="dateTime" class="form-label fw-semibold">
              <i class="bi bi-calendar3 me-1"></i>Date & Time:
            </label>
            <input type="datetime-local" id="dateTime" formControlName="dateTime"
              class="form-control form-control-lg" 
              [min]="minDate"/>
            <div *ngIf="itemForm.get('dateTime')?.hasError('required') && itemForm.get('dateTime')?.touched"
              class="text-danger mt-1 small">
              <i class="bi bi-exclamation-circle me-1"></i>Date and Time are required.
            </div>
            <div *ngIf="itemForm.get('dateTime')?.hasError('dateInPast')"
              class="text-danger mt-1 small">
              <i class="bi bi-exclamation-circle me-1"></i>Event date must be in the future.
            </div>
          </div>

          <div class="mb-4">
            <label for="location" class="form-label fw-semibold">
              <i class="bi bi-geo-alt me-1"></i>Location:
            </label>
            <input type="text" id="location" formControlName="location"
              class="form-control form-control-lg" 
              placeholder="Enter event location"/>
            <div *ngIf="itemForm.get('location')?.hasError('required') && itemForm.get('location')?.touched"
              class="text-danger mt-1 small">
              <i class="bi bi-exclamation-circle me-1"></i>Location is required.
            </div>
          </div>

          <div class="mb-4">
            <label for="status" class="form-label fw-semibold">
              <i class="bi bi-info-circle me-1"></i>Status:
            </label>
            <select id="status" class="form-select form-select-lg"
              formControlName="status">
              <option value="" disabled selected>Select status</option>
              <option value="Scheduled">Scheduled</option>
              <option value="Ongoing">Ongoing</option>
              <option value="Completed">Completed</option>
              <option value="Cancelled">Cancelled</option>
            </select>
            <div *ngIf="itemForm.get('status')?.hasError('required') && itemForm.get('status')?.touched"
              class="text-danger mt-1 small">
              <i class="bi bi-exclamation-circle me-1"></i>Status is required.
            </div>
          </div>

          <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary btn-lg submit-btn" data-bs-dismiss="modal">
              <i class="bi bi-check-circle me-2"></i>{{ isUpdate ? 'Update Event' : 'Create Event' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

